<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Swara → Music • V1.1 (Stability Fix)</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="wrap">
    <h1>Swara → Music • V1.1</h1>
    <p class="sub">Stability pass: numeric sanitization + error‑token skipping + basic tests. Still offline, no libraries. 12‑TET via <span class="badge">Web Audio API</span>.</p>

    <div class="grid">
      <!-- Left: Editor -->
      <div class="card">
        <h2>Sequence</h2>
        <div class="content">
          <label for="seq">Swaras (see syntax below)</label>
          <textarea id="seq" placeholder="Example: S R G M P D N S' | S' N D P M G R S"></textarea>

          <div class="examples">
            <button id="ex1">Pentatonic demo</button>
            <button id="ex2">Komal notes demo</button>
            <button id="ex3">Durations demo</button>
          </div>
			
		<div class="control-group">
		  <label for="ragaSelect">Raga:</label>
		  <select id="ragaSelect">
			<option value="">-- None --</option>
			<option value="mayamalavagowla">Mayamalavagowla</option>
			<option value="shankarabharanam">Shankarabharanam</option>
			<option value="kharaharapriya">Kharaharapriya</option>
			<option value="todi">Todi</option>
			<option value="bhairavi">Bhairavi</option>
			<option value="kalyani">Kalyani</option>
			<option value="kapi">Kapi</option>
			<option value="desh">Desh</option>
			<!-- add more later -->
		  </select>
		</div>

          <div class="row">
            <div>
              <label for="saNote">Sa (Tonic)</label>
              <select id="saNote"></select>
            </div>
            <div>
              <label for="saOct">Octave</label>
              <select id="saOct">
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4" selected>4</option>
                <option value="5">5</option>
              </select>
            </div>
            <div>
              <label for="bpm">Tempo (BPM)</label>
              <input id="bpm" type="number" min="30" max="240" value="96" />
            </div>
            <div>
              <label for="wave">Timbre</label>
              <select id="wave">
                <option value="sine">Sine</option>
                <option value="triangle" selected>Triangle</option>
                <option value="square">Square</option>
                <option value="sawtooth">Sawtooth</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div>
              <label for="attack">Attack (s)</label>
              <input id="attack" type="number" min="0" max="1" step="0.01" value="0.02" />
            </div>
            <div>
              <label for="release">Release (s)</label>
              <input id="release" type="number" min="0" max="2" step="0.01" value="0.12" />
            </div>
            <div>
              <label for="gain">Gain</label>
              <input id="gain" type="number" min="0" max="1" step="0.01" value="0.25" />
            </div>
          </div>

          <div class="btns">
            <button class="primary" id="play">▶ Play</button>
            <button class="secondary" id="stop">■ Stop</button>
            <button class="secondary" id="showParsed">Show parsed</button>
            <button class="secondary" id="copyWestern">Copy Western notes</button>
            <button class="secondary" id="runTests">Run tests</button>
            <button class="danger" id="clear">Clear</button>
          </div>

          <p class="mini" style="margin-top:10px"><strong>Syntax:</strong> Uppercase = shuddha (R,G,D,N). Lowercase = komal (r,g,d,n). Tivra Ma = <code>M#</code>. Octave: <code>S'</code> higher, <code>S.</code> lower (repeat ' or . for multiple octaves). Duration in beats: append a number e.g., <code>G2</code> = 2 beats. Use spaces or <code>|</code> as separators. Rests: <code>_</code> (underscore), e.g., <code>_2</code> for two beats rest.</p>
        </div>
      </div>

      <!-- Right: Output / Help -->
      <div class="card">
        <h2>Parsed / Log</h2>
        <div class="content">
          <div id="status" class="pill">Ready</div>
          <pre id="log" class="log" style="margin-top:10px"></pre>
          <div class="footer">
            <div><strong>Mapping</strong>: S(0), r(1), R(2), g(3), G(4), M(5), M#(6), P(7), d(8), D(9), n(10), N(11).</div>
            <div>Engine: Web Audio API. Tuning: A4=440, 12‑TET. Sa is aligned to selected Western pitch.</div>
          </div>
        </div>
      </div>
    </div>
  </div>
<script src="script.js"></script>
</body>
</html>
